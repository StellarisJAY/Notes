# ICMP和IGMP

## ICMP网络控制报文协议

### 作用

- 差错通知：向发送方传递错误信息，网络传输中可能出现错误，这时需要一种机制来告知发送方错误的发生
- 询问信息：发送方向接收方询问信息，包括IP是否存在、子网掩码、时间信息等

![img](https://images2018.cnblogs.com/blog/806469/201803/806469-20180306123848996-664828184.png)

### ICMP报文格式

ICMP本身是在IP层工作的，并且使用IP数据包传输。一个ICMP报文就由IP首部和ICMP数据部分组成。

![img](https://images2018.cnblogs.com/blog/806469/201803/806469-20180306123940403-1730998630.png)

![img](https://images2018.cnblogs.com/blog/806469/201803/806469-20180306123952687-1669696526.png)

### ping命令

我们常使用ping命令来确定两台主机之间的连接，ping命令就使用了IP层的ICMP实现。相当于上面说的ICMP的第二个作用，询问信息

![img](https://images2018.cnblogs.com/blog/806469/201803/806469-20180306124106517-1608215708.png)

## 源点抑制

网络中某个路由器收到了过多的报文，可能无法处理而导致报文丢弃，这时路由器会发送ICMP报文来抑制发送方的发送速度。这叫做

![img](https://images2018.cnblogs.com/blog/806469/201803/806469-20180306124046051-967369342.png)

## traceroute命令

为了调查到通信对方的路径现在是怎么样了，使用的是traceroute 命令。它与ping 并列，是代表网络命令。这个traceroute 也是ICMP 的典型实现之一。

### ICMP泛洪攻击

也就是向主机发送大量的ping命令，使主机尽全力返回ICMP报文，以达到让其他传输受阻的攻击。



## IGMP网络组管理协议

组播通信模型中，发送方不需要关心组内每一台主机的地址，只需要将组播报文发送到组播路由器的组播地址即可。但是组播路由器需要知道每一台主机的地址，这就需要有一种加入组的机制。IGMP就是用来在接收者主机和与其所在网段直接相邻的**组播路由器**之间建立、维护组播组成员关系的协议。

### 报文分类

- 查询报文：组播路由器定时发出通用查询报文（下图的组播路由器每125s发送一次）。用来查询该网段有哪些组播组的成员。
- 报告报文：该报文由主机发出。可对组播路由器发出的查询报文进行回应，同时主机在主动加入特定组的时候，也会主动发送该报文报告。
- 离开报文：该报文由主机发出。当主机离开组播组时发送此报文，向组播路由器报告离开了特定的组播组。

